import{_ as r,C as h,c as d,o as p,ag as k,G as t,j as i,w as l,a as s}from"./chunks/framework.Bksy39di.js";const F=JSON.parse('{"title":"支持 Gradle 插件变体","description":"","frontmatter":{},"headers":[],"relativePath":"kotlin/gradle-plugin-variants.md","filePath":"kotlin/gradle-plugin-variants.md","lastUpdated":1754307826000}'),E={name:"kotlin/gradle-plugin-variants.md"};function o(g,a,c,y,u,b){const e=h("tab"),n=h("tabs");return p(),d("div",null,[a[6]||(a[6]=k('<h1 id="支持-gradle-插件变体" tabindex="-1">支持 Gradle 插件变体 <a class="header-anchor" href="#支持-gradle-插件变体" aria-label="Permalink to &quot;支持 Gradle 插件变体&quot;">​</a></h1><p>Gradle 7.0 为 Gradle 插件作者引入了一项新特性 — <a href="https://docs.gradle.org/7.0/userguide/implementing_gradle_plugins.html#plugin-with-variants" target="_blank" rel="noreferrer">带变体的插件</a>。这项特性使得添加对最新 Gradle 特性的支持变得更容易，同时又能保持与旧版 Gradle 版本的兼容性。了解更多关于 <a href="https://docs.gradle.org/current/userguide/variant_model.html" target="_blank" rel="noreferrer">Gradle 中的变体选择</a>。</p><p>借助 Gradle 插件变体，Kotlin 团队可以为不同的 Gradle 版本发布不同的 Kotlin Gradle plugin (KGP) 变体。目标是在 <code>main</code> 变体中支持基础 Kotlin 编译，该变体对应于 Gradle 支持的最早版本。每个变体都将包含相应版本中 Gradle 特性的实现。最新变体将支持最新的 Gradle 特性集。采用这种方法，可以扩展对功能性有限的旧版 Gradle 版本的支持。</p><p>目前，Kotlin Gradle plugin 包含以下变体：</p><table tabindex="0"><thead><tr><th>变体名称</th><th>对应 Gradle 版本</th></tr></thead><tbody><tr><td><code>main</code></td><td>7.6.0–7.6.3</td></tr><tr><td><code>gradle80</code></td><td>8.0–8.0.2</td></tr><tr><td><code>gradle81</code></td><td>8.1.1</td></tr><tr><td><code>gradle82</code></td><td>8.2.1–8.4</td></tr><tr><td><code>gradle85</code></td><td>8.5</td></tr><tr><td><code>gradle86</code></td><td>8.6-8.7</td></tr><tr><td><code>gradle88</code></td><td>8.8-8.10</td></tr><tr><td><code>gradle811</code></td><td>8.11-8.12</td></tr><tr><td><code>gradle813</code></td><td>8.13 and higher</td></tr></tbody></table><p>在未来的 Kotlin 版本中，将添加更多变体。</p><p>要检测你的构建使用了哪个变体，请启用 <a href="https://docs.gradle.org/current/userguide/logging.html#sec:choosing_a_log_level" target="_blank" rel="noreferrer"><code>--info</code> 日志级别</a> 并在输出中查找以 <code>Using Kotlin Gradle plugin</code> 开头的字符串，例如，<code>Using Kotlin Gradle plugin main variant</code>。</p><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><div class="note custom-block"><p class="custom-block-title">NOTE</p><p>以下是针对 Gradle 中变体选择的一些已知问题的临时解决方案： * <a href="https://github.com/gradle/gradle/issues/20545" target="_blank" rel="noreferrer">ResolutionStrategy 在 pluginManagement 中对多变体插件无效</a> * <a href="https://github.com/gradle/gradle/issues/20847" target="_blank" rel="noreferrer">当插件作为 <code>buildSrc</code> 公共依赖项添加时，插件变体会被忽略</a></p></div><h3 id="gradle-无法在自定义配置中选择-kgp-变体" tabindex="-1">Gradle 无法在自定义配置中选择 KGP 变体 <a class="header-anchor" href="#gradle-无法在自定义配置中选择-kgp-变体" aria-label="Permalink to &quot;Gradle 无法在自定义配置中选择 KGP 变体&quot;">​</a></h3><p>Gradle 无法在自定义配置中选择 KGP 变体，这是一个预期情况。 如果你使用了自定义 Gradle 配置：</p>',11)),t(n,{group:"build-script"},{default:l(()=>[t(e,{title:"Kotlin","group-key":"kotlin"},{default:l(()=>a[0]||(a[0]=[i("div",{class:"language-kotlin vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"kotlin"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"configurations."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"register"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"customConfiguration"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1}),t(e,{title:"Groovy","group-key":"groovy"},{default:l(()=>a[1]||(a[1]=[i("div",{class:"language-groovy vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"groovy"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"configurations"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"register("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"customConfiguration"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1})]),_:1}),a[7]||(a[7]=i("p",null,"并且想要添加对 Kotlin Gradle plugin 的依赖项，例如：",-1)),t(n,{group:"build-script"},{default:l(()=>[t(e,{title:"Kotlin","group-key":"kotlin"},{default:l(()=>a[2]||(a[2]=[i("div",{class:"language-kotlin vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"kotlin"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dependencies"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    customConfiguration"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"org.jetbrains.kotlin:kotlin-gradle-plugin:2.2.10"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1}),t(e,{title:"Groovy","group-key":"groovy"},{default:l(()=>a[3]||(a[3]=[i("div",{class:"language-groovy vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"groovy"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"dependencies {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    customConfiguration "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'org.jetbrains.kotlin:kotlin-gradle-plugin:2.2.10'")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1})]),_:1}),a[8]||(a[8]=i("p",null,[s("你需要向你的 "),i("code",null,"customConfiguration"),s(" 添加以下属性：")],-1)),t(n,{group:"build-script"},{default:l(()=>[t(e,{title:"Kotlin","group-key":"kotlin"},{default:l(()=>a[4]||(a[4]=[i("div",{class:"language-kotlin vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"kotlin"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"configurations"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    customConfiguration"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        attributes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            attribute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Usage.USAGE_ATTRIBUTE,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project."),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"s."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"named"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Usage.class, Usage.JAVA_RUNTIME)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            attribute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Category.CATEGORY_ATTRIBUTE,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project."),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"s."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"named"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Category.class, Category.LIBRARY)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 如果你想依赖于某个特定的 KGP 变体:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"            attribute"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE,")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project."),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"s."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"named"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"7.0"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1}),t(e,{title:"Groovy","group-key":"groovy"},{default:l(()=>a[5]||(a[5]=[i("div",{class:"language-groovy vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"groovy"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code",tabindex:"0"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"configurations {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    customConfiguration {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        attributes {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            attribute(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                Usage."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"USAGE_ATTRIBUTE"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"objects"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"named("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Usage"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Usage."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"JAVA_RUNTIME"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            attribute(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                Category."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"CATEGORY_ATTRIBUTE"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"objects"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"named("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Category"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Category."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"LIBRARY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 如果你想依赖于某个特定的 KGP 变体:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            attribute(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                GradlePluginApiVersion."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"GRADLE_PLUGIN_API_VERSION_ATTRIBUTE"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                project"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"objects"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"named("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'7.0'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])])],-1)])),_:1})]),_:1}),a[9]||(a[9]=k(`<p>否则，你将收到一个类似以下的错误：</p><div class="language-none vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">none</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> &gt; Could not resolve all files for configuration &#39;:customConfiguration&#39;.</span></span>
<span class="line"><span>      &gt; Could not resolve org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0.</span></span>
<span class="line"><span>        Required by:</span></span>
<span class="line"><span>            project :</span></span>
<span class="line"><span>         &gt; Cannot choose between the following variants of org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0:</span></span>
<span class="line"><span>             - gradle70RuntimeElements</span></span>
<span class="line"><span>             - runtimeElements</span></span>
<span class="line"><span>           All of them match the consumer attributes:</span></span>
<span class="line"><span>             - Variant &#39;gradle70RuntimeElements&#39; capability org.jetbrains.kotlin:kotlin-gradle-plugin:1.7.0:</span></span>
<span class="line"><span>                 - Unmatched attributes:</span></span></code></pre></div><h2 id="下一步是什么" tabindex="-1">下一步是什么？ <a class="header-anchor" href="#下一步是什么" aria-label="Permalink to &quot;下一步是什么？&quot;">​</a></h2><p>了解更多关于 <a href="https://docs.gradle.org/current/userguide/userguide.html" target="_blank" rel="noreferrer">Gradle 的基础知识和具体细节</a>。</p>`,4))])}const C=r(E,[["render",o]]);export{F as __pageData,C as default};
