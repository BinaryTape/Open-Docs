import{_ as a,c as i,o as e,ag as n}from"./chunks/framework.Bksy39di.js";const c=JSON.parse('{"title":"WebSocket Deflate拡張","description":"","frontmatter":{},"headers":[],"relativePath":"ja/ktor/server-websocket-deflate.md","filePath":"ja/ktor/server-websocket-deflate.md","lastUpdated":1755457140000}'),t={name:"ja/ktor/server-websocket-deflate.md"};function l(p,s,h,k,r,o){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="websocket-deflate拡張" tabindex="-1">WebSocket Deflate拡張 <a class="header-anchor" href="#websocket-deflate拡張" aria-label="Permalink to &quot;WebSocket Deflate拡張&quot;">​</a></h1><p>Ktorは、クライアントとサーバー向けに<code>Deflate</code> WebSocket拡張機能 <a href="https://tools.ietf.org/html/rfc7692" target="_blank" rel="noreferrer">RFC-7692</a> を実装しています。この拡張機能は、送信前にフレームを透過的に圧縮し、受信後に解凍できます。大量のテキストデータを送信する場合は、この拡張機能を有効にすると便利です。</p><h2 id="インストール" tabindex="-1">インストール <a class="header-anchor" href="#インストール" aria-label="Permalink to &quot;インストール&quot;">​</a></h2><p>この拡張機能を使用するには、まずインストールする必要があります。そのためには、<code>extensions</code>ブロック内で<code>install</code>メソッドを使用できます。</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// For client and server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WebSockets) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WebSocketDeflateExtension) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * Compression level to use for [java.util.zip.Deflater].</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            compressionLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Deflater.DEFAULT_COMPRESSION</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * Prevent compressing small outgoing frames.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            compressIfBiggerThan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="高度な設定パラメーター" tabindex="-1">高度な設定パラメーター <a class="header-anchor" href="#高度な設定パラメーター" aria-label="Permalink to &quot;高度な設定パラメーター&quot;">​</a></h3><h4 id="コンテキストテイクオーバー" tabindex="-1">コンテキストテイクオーバー <a class="header-anchor" href="#コンテキストテイクオーバー" aria-label="Permalink to &quot;コンテキストテイクオーバー&quot;">​</a></h4><p>クライアント（およびサーバー）が圧縮ウィンドウを使用すべきかどうかを指定します。これらのパラメーターを有効にすると、単一セッションあたりに割り当てられるスペースの量を削減します。なお、<code>java.util.zip.Deflater</code> APIの制限のため、ウィンドウサイズは設定できません。値は<code>15</code>に固定されています。</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clientNoContextTakeOver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serverNoContextTakeOver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span></code></pre></div><p>これらのパラメーターは<a href="https://tools.ietf.org/html/rfc7692#section-7.1.1" target="_blank" rel="noreferrer">RFC-7692 Section 7.1.1</a>に記述されています。</p><h4 id="圧縮条件の指定" tabindex="-1">圧縮条件の指定 <a class="header-anchor" href="#圧縮条件の指定" aria-label="Permalink to &quot;圧縮条件の指定&quot;">​</a></h4><p>圧縮条件を明示的に指定するには、<code>compressIf</code>メソッドを使用できます。例えば、テキストのみを圧縮するには:</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compressIf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Frame.Text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>compressIf</code>へのすべての呼び出しは、圧縮が行われる前に評価されます。</p><h4 id="プロトコルリストの微調整" tabindex="-1">プロトコルリストの微調整 <a class="header-anchor" href="#プロトコルリストの微調整" aria-label="Permalink to &quot;プロトコルリストの微調整&quot;">​</a></h4><p>送信するプロトコルのリストは、<code>configureProtocols</code>メソッドを使用して必要に応じて編集できます。</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configureProtocols</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { protocols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    protocols.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    protocols.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,17)]))}const E=a(t,[["render",l]]);export{c as __pageData,E as default};
