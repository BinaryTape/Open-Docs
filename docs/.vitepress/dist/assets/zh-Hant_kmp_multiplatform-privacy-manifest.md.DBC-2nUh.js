import{_ as i}from"./chunks/app-store-required-reasons-warning.Jd9b2vB2.js";import{_ as s,c as e,o as t,ag as n}from"./chunks/framework.Bksy39di.js";const m=JSON.parse('{"title":"適用於 iOS 應用程式的隱私權清單","description":"","frontmatter":{},"headers":[],"relativePath":"zh-Hant/kmp/multiplatform-privacy-manifest.md","filePath":"zh-Hant/kmp/multiplatform-privacy-manifest.md","lastUpdated":1755516278000}'),l={name:"zh-Hant/kmp/multiplatform-privacy-manifest.md"};function p(r,a,o,h,c,d){return t(),e("div",null,a[0]||(a[0]=[n('<h1 id="適用於-ios-應用程式的隱私權清單" tabindex="-1">適用於 iOS 應用程式的隱私權清單 <a class="header-anchor" href="#適用於-ios-應用程式的隱私權清單" aria-label="Permalink to &quot;適用於 iOS 應用程式的隱私權清單&quot;">​</a></h1><p>如果您的應用程式旨在用於 Apple App Store 並使用<a href="https://developer.apple.com/documentation/bundleresources/describing-use-of-required-reason-api" target="_blank" rel="noreferrer">必備原因 API</a>， App Store Connect 可能會發出警告，指出該應用程式沒有正確的隱私權清單：</p><p><img src="'+i+`" alt="所需原因警告" width="700"></p><p>它可能會影響任何 Apple 生態系統應用程式，無論是原生或多平台。您的應用程式可能透過第三方函式庫或 SDK 使用必備原因 API，這可能不明顯。Kotlin Multiplatform 可能是您未曾察覺使用 API 的框架之一。</p><p>在此頁面上，您將找到問題的詳細說明以及處理該問題的建議。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>本頁面反映了 Kotlin 團隊對該問題目前的理解。 隨著我們獲得更多關於公認方法和解決方案的資料和知識，我們將更新本頁面以反映這些資訊。</p></div><h2 id="問題為何" tabindex="-1">問題為何 <a class="header-anchor" href="#問題為何" aria-label="Permalink to &quot;問題為何&quot;">​</a></h2><p>Apple 對 App Store 提交的要求<a href="https://developer.apple.com/news/?id=r1henawx" target="_blank" rel="noreferrer">已於 2024 年春季發生變化</a>。 <a href="https://appstoreconnect.apple.com" target="_blank" rel="noreferrer">App Store Connect</a> 不再接受未在其隱私權清單中指定使用必備原因 API 理由的應用程式。</p><p>這是一個自動檢查，而非手動審核：您的應用程式程式碼會被分析，然後您會收到一封電子郵件，其中列出所有問題。該電子郵件將提及「ITMS-91053：遺失 API 宣告」問題，並列出應用程式中屬於<a href="https://developer.apple.com/documentation/bundleresources/describing-use-of-required-reason-api" target="_blank" rel="noreferrer">必備原因</a>類別的所有 API。</p><p>理想情況下，您的應用程式使用的所有 SDK 都會提供自己的隱私權清單，您無需擔心。 但是，如果您的某些依賴項沒有這樣做，您的 App Store 提交可能會被標記。</p><h2 id="如何解決" tabindex="-1">如何解決 <a class="header-anchor" href="#如何解決" aria-label="Permalink to &quot;如何解決&quot;">​</a></h2><p>在您嘗試提交應用程式並收到 App Store 提供的詳細問題清單後，您可以依照 Apple 文件建置您的清單：</p><ul><li><a href="https://developer.apple.com/documentation/bundleresources/privacy-manifest-files" target="_blank" rel="noreferrer">隱私權清單檔案概觀</a></li><li><a href="https://developer.apple.com/documentation/bundleresources/describing-data-use-in-privacy-manifests" target="_blank" rel="noreferrer">描述隱私權清單中的資料使用</a></li><li><a href="https://developer.apple.com/documentation/bundleresources/describing-use-of-required-reason-api" target="_blank" rel="noreferrer">描述必備原因 API 的使用</a></li></ul><p>結果檔案是一組字典。對於每個被存取的 API 類型，從提供的清單中選擇一個或多個使用它的原因。Xcode 透過提供視覺化佈局和下拉式清單，其中包含每個欄位的有效值，幫助編輯<code>.xcprivacy</code>檔案。</p><p>您可以使用<a href="#find-usages-of-required-reason-apis">專用工具</a>來尋找您的 Kotlin 框架依賴項中必備原因 API 的使用情況，以及<a href="#place-the-xcprivacy-file-in-your-kotlin-artifacts">單獨的外掛程式</a>來將 <code>.xcprivacy</code> 檔案與您的 Kotlin 產物捆綁在一起。</p><p>如果新的隱私權清單未能滿足 App Store 的要求，或者您無法弄清楚如何執行這些步驟，請聯絡我們並在<a href="https://youtrack.jetbrains.com/issue/KT-67603" target="_blank" rel="noreferrer">此 YouTrack 問題</a>中分享您的案例。</p><h2 id="尋找必備原因-api-的使用情況" tabindex="-1">尋找必備原因 API 的使用情況 <a class="header-anchor" href="#尋找必備原因-api-的使用情況" aria-label="Permalink to &quot;尋找必備原因 API 的使用情況&quot;">​</a></h2><p>您的應用程式或其中一個依賴項中的 Kotlin 程式碼可能會從 <code>platform.posix</code> 等函式庫存取必備原因 API，例如 <code>fstat</code>：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> platform.posix.fstat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useRequiredReasonAPI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    fstat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在某些情況下，可能很難確定哪些依賴項使用了必備原因 API。 為了幫助您找到它們，我們建立了一個簡單的工具。</p><p>若要使用它，請在您的專案中宣告 Kotlin 框架的目錄中執行以下命令：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/bin/python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/JetBrains/kotlin/raw/rrf_v0.0.1/libraries/tools/required-reason-finder/required_reason_finder.py)&quot;</span></span></code></pre></div><p>您也可以單獨<a href="https://github.com/JetBrains/kotlin/blob/rrf_v0.0.1/libraries/tools/required-reason-finder/required_reason_finder.py" target="_blank" rel="noreferrer">下載此腳本</a>，檢查它，然後使用 <code>python3</code> 執行它。</p><h2 id="將-xcprivacy-檔案放入您的-kotlin-產物中" tabindex="-1">將 .xcprivacy 檔案放入您的 Kotlin 產物中 <a class="header-anchor" href="#將-xcprivacy-檔案放入您的-kotlin-產物中" aria-label="Permalink to &quot;將 .xcprivacy 檔案放入您的 Kotlin 產物中&quot;">​</a></h2><p>如果您需要將 <code>PrivacyInfo.xcprivacy</code> 檔案與您的 Kotlin 產物捆綁在一起，請使用 <code>apple-privacy-manifests</code> 外掛程式：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    kotlin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;multiplatform&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    kotlin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;apple-privacy-manifests&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) version </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kotlin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    privacyManifest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        embed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            privacyManifest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layout.projectDirectory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PrivacyInfo.xcprivacy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).asFile,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>此外掛程式會將隱私權清單檔案複製到<a href="https://developer.apple.com/documentation/bundleresources/adding-a-privacy-manifest-to-your-app-or-third-party-sdk?language=objc" target="_blank" rel="noreferrer">對應的輸出位置</a>。</p><h2 id="已知使用情況" tabindex="-1">已知使用情況 <a class="header-anchor" href="#已知使用情況" aria-label="Permalink to &quot;已知使用情況&quot;">​</a></h2><h3 id="compose-multiplatform" tabindex="-1">Compose Multiplatform <a class="header-anchor" href="#compose-multiplatform" aria-label="Permalink to &quot;Compose Multiplatform&quot;">​</a></h3><p>使用 Compose Multiplatform 可能會導致您的二進位檔中出現 <code>fstat</code>、<code>stat</code> 和 <code>mach_absolute_time</code> 的使用情況。 儘管這些函數並不用於追蹤或指紋識別，也不會從裝置發送，Apple 仍可能將它們標記為缺少必備原因的 API。</p><p>如果您必須為 <code>stat</code> 和 <code>fstat</code> 的使用指定原因，請使用 <code>0A2A.1</code>。對於 <code>mach_absolute_time</code>，請使用 <code>35F9.1</code>。</p><p>有關 Compose Multiplatform 中使用的必備原因 API 的進一步更新，請關注<a href="https://github.com/JetBrains/compose-multiplatform/issues/4738" target="_blank" rel="noreferrer">此問題</a>。</p><h3 id="_1-9-10-或更早版本中的-kotlin-native-執行時" tabindex="-1">1.9.10 或更早版本中的 Kotlin/Native 執行時 <a class="header-anchor" href="#_1-9-10-或更早版本中的-kotlin-native-執行時" aria-label="Permalink to &quot;1.9.10 或更早版本中的 Kotlin/Native 執行時&quot;">​</a></h3><p><code>mach_absolute_time</code> API 在 Kotlin/Native 執行時中的 <code>mimalloc</code> 配置器中使用。這是 Kotlin 1.9.10 及更早版本中的預設配置器。</p><p>我們建議升級到 Kotlin 1.9.20 或更高版本。如果無法升級，請更改記憶體配置器。 為此，請在您的 Gradle 建置腳本中為當前 Kotlin 配置器設定 <code>-Xallocator=custom</code> 編譯選項，或為系統配置器設定 <code>-Xallocator=std</code>。</p><p>有關更多資訊，請參閱 <a href="https://kotlinlang.org/docs/native-memory-manager.html" target="_blank" rel="noreferrer">Kotlin/Native 記憶體管理</a>。</p>`,36)]))}const f=s(l,[["render",p]]);export{m as __pageData,f as default};
