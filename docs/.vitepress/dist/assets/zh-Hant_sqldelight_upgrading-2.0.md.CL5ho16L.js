import{_ as i,c as a,o as e,ag as l}from"./chunks/framework.Bksy39di.js";const c=JSON.parse('{"title":"升級到 2.0","description":"","frontmatter":{},"headers":[],"relativePath":"zh-Hant/sqldelight/upgrading-2.0.md","filePath":"zh-Hant/sqldelight/upgrading-2.0.md","lastUpdated":1748443437000}'),t={name:"zh-Hant/sqldelight/upgrading-2.0.md"};function n(p,s,h,d,k,r){return e(),a("div",null,s[0]||(s[0]=[l(`<h1 id="升級到-2-0" tabindex="-1">升級到 2.0 <a class="header-anchor" href="#升級到-2-0" aria-label="Permalink to &quot;升級到 2.0&quot;">​</a></h1><p>SQLDelight 2.0 對 Gradle 外掛程式和執行時 API 進行了一些破壞性變更。</p><p>此頁面列出了這些破壞性變更及其新的 2.0 對應項。有關新功能和其他變更的完整列表，請參閱<a href="/zh-Hant/sqldelight/changelog">變更日誌</a>。</p><h2 id="新的套件名稱和構件組" tabindex="-1">新的套件名稱和構件組 <a class="header-anchor" href="#新的套件名稱和構件組" aria-label="Permalink to &quot;新的套件名稱和構件組&quot;">​</a></h2><p>所有 <code>com.squareup.sqldelight</code> 的實例都需要替換為 <code>app.cash.sqldelight</code>。</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar">Gradle 依賴項</div><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">plugins {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  id(&quot;com.squareup.sqldelight&quot;) version &quot;2.1.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  id(&quot;app.cash.sqldelight&quot;) version &quot;2.1.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dependencies {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  implementation(&quot;com.squareup.sqldelight:sqlite-driver:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  implementation(&quot;app.cash.sqldelight:sqlite-driver:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">For pure-Android SqlDelight 1.x projects, use android-driver and coroutine-extensions-jvm:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dependencies {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  implementation(&quot;com.squareup.sqldelight:android-driver:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  implementation(&quot;app.cash.sqldelight:android-driver:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  implementation(&quot;com.squareup.sqldelight:coroutines-extensions:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  implementation(&quot;app.cash.sqldelight:coroutines-extensions-jvm:2.1.0&quot;)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div><div class="vp-code-block-title"><div class="vp-code-block-title-bar">在程式碼中</div><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-import com.squareup.sqldelight.db.SqlDriver</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+import app.cash.sqldelight.db.SqlDriver</span></span></code></pre></div></div><h2 id="gradle-配置變更" tabindex="-1">Gradle 配置變更 <a class="header-anchor" href="#gradle-配置變更" aria-label="Permalink to &quot;Gradle 配置變更&quot;">​</a></h2><ul><li><p>SQLDelight 2.0 要求 Java 11 用於建構，Java 8 用於執行時。</p></li><li><p>SQLDelight 配置 API 現在使用託管屬性 (managed properties) 和 <code>DomainObjectCollection</code> 來管理資料庫。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-NyqYY" id="tab-0r5tZXL" checked><label data-title="Kotlin" for="tab-0r5tZXL">Kotlin</label></div><div class="blocks"><div class="language-kotlin vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqldelight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  databases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// (1)!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Database&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// (2)!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><pre><code>1.  新的 \`DomainObjectCollection\` 包裝器。
2.  現在是一個 \`Property&lt;String&gt;\`。
</code></pre><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-AtfnC" id="tab-6sZvJxF" checked><label data-title="Groovy" for="tab-6sZvJxF">Groovy</label></div><div class="blocks"><div class="language-kotlin vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sqldelight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  databases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// (1)!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;com.example&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><pre><code>1.  新的 \`DomainObjectCollection\` 包裝器。
</code></pre></li><li><p>sourceFolders 設定已更名為 srcDirs</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-c0z8P" id="tab-QJVsJI7" checked><label data-title="Kotlin" for="tab-QJVsJI7">Kotlin</label><input type="radio" name="group-c0z8P" id="tab-Pq2dqoy"><label data-title="Groovy" for="tab-Pq2dqoy">Groovy</label></div><div class="blocks"><div class="language-groovy vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databases {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyDatabase&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">set(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      srcDirs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">setFrom(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;src/main/sqldelight&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-groovy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databases {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MyDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;com.example&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      srcDirs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src/main/sqldelight&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></li><li><p>你的資料庫的 SQL 變體現在透過 Gradle 依賴項指定。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-NSWBb" id="tab-tc-yugU" checked><label data-title="Kotlin" for="tab-tc-yugU">Kotlin</label><input type="radio" name="group-NSWBb" id="tab-vI9zWy7"><label data-title="Groovy" for="tab-vI9zWy7">Groovy</label></div><div class="blocks"><div class="language-groovy vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databases {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyDatabase&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">set(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dialect(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app.cash.sqldelight:mysql-dialect:2.1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Version catalogs also work!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dialect(libs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dialects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-groovy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  databases {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    MyDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      packageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;com.example&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dialect </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app.cash.sqldelight:mysql-dialect:2.1.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Version catalogs also work!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dialect libs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sqldelight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dialects</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><p>目前支援的變體有 <code>mysql-dialect</code>、<code>postgresql-dialect</code>、<code>hsql-dialect</code>、<code>sqlite-3-18-dialect</code>、<code>sqlite-3-24-dialect</code>、<code>sqlite-3-25-dialect</code>、<code>sqlite-3-30-dialect</code>、<code>sqlite-3-35-dialect</code> 和 <code>sqlite-3-38-dialect</code>。</p></li></ul><h2 id="執行時變更" tabindex="-1">執行時變更 <a class="header-anchor" href="#執行時變更" aria-label="Permalink to &quot;執行時變更&quot;">​</a></h2><ul><li><p>基本類型現在必須匯入到 <code>.sq</code> 和 <code>.sqm</code> 檔案中。</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+import kotlin.Boolean;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CREATE TABLE HockeyPlayer (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name TEXT NOT NULL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  good INTEGER </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">AS Boolean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>一些以前支援的類型現在需要配接器 (adapter)。基本類型的配接器可在 <code>app.cash.sqldelight:primitive-adapters:2.1.0</code> 構件中找到。例如，用於執行 <code>INTEGER As kotlin.Int</code> 轉換的 <code>IntColumnAdapter</code>。</p></li><li><p><code>AfterVersionWithDriver</code> 類型已被移除，取而代之的是現在始終包含驅動程式的 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-after-version" target="_blank" rel="noreferrer"><code>AfterVersion</code></a>。<code>migrateWithCallbacks</code> 擴展函式已被移除，取而代之的是現在接受回呼的主要 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-schema/#-775472427%2FFunctions%2F-2112917107" target="_blank" rel="noreferrer"><code>migrate</code></a> 方法。</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Database.Schema.</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">migrate</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">WithCallbacks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  driver = driver,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  oldVersion = 1,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  newVersion = Database.Schema.version,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  AfterVersionWithDriver(3) { driver -&gt;</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-    driver.execute(null, &quot;INSERT INTO test (value) VALUES(&#39;hello&#39;)&quot;, 0)</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-  }</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  AfterVersion(3) { driver -&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+    driver.execute(null, &quot;INSERT INTO test (value) VALUES(&#39;hello&#39;)&quot;, 0)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div></li><li><p><code>Schema</code> 類型不再是 <code>SqlDriver</code> 的巢狀類型，現在被稱為 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-schema" target="_blank" rel="noreferrer"><code>SqlSchema</code></a>。</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-val schema: SqlDriver.Schema</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+val schema: SqlSchema</span></span></code></pre></div></li><li><p><a href="https://sqldelight.github.io/sqldelight/latest/2.x/extensions/androidx-paging3/app.cash.sqldelight.paging3/" target="_blank" rel="noreferrer">Paging3 擴展 API</a> 已更改為僅允許整數類型 (int types) 作為計數。</p></li><li><p><a href="https://sqldelight.github.io/sqldelight/latest/2.x/extensions/coroutines-extensions/app.cash.sqldelight.coroutines/" target="_blank" rel="noreferrer">協程擴展 API</a> 現在要求明確傳入一個調度器 (dispatcher)。</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">val players: Flow&lt;List&lt;HockeyPlayer&gt;&gt; =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  playerQueries.selectAll()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .asFlow()</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+   .mapToList(Dispatchers.IO)</span></span></code></pre></div></li><li><p>一些驅動程式方法，例如 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-driver/execute" target="_blank" rel="noreferrer"><code>execute()</code></a>、<a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-driver/execute-query" target="_blank" rel="noreferrer"><code>executeQuery()</code></a>、<code>newTransaction()</code> 和 <code>endTransaction()</code>，現在會返回一個 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-query-result" target="_blank" rel="noreferrer"><code>QueryResult</code></a> 物件。請使用 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-query-result/value" target="_blank" rel="noreferrer"><code>QueryResult.value</code></a> 來存取返回值。</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-driver.executeQuery(null, &quot;PRAGMA user_version&quot;, { /*...*/ })</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+driver.executeQuery(null, &quot;PRAGMA user_version&quot;, { /*...*/ }).value</span></span></code></pre></div><p>此變更使得驅動程式實作可以基於非阻塞 API，其中返回值可以使用掛起方法 (suspending method) <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-query-result/await" target="_blank" rel="noreferrer"><code>QueryResult.await()</code></a> 進行存取。</p></li><li><p><code>SqlCursor</code> 介面上的 <a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-cursor/next" target="_blank" rel="noreferrer"><code>next()</code></a> 方法也已更改為返回 <code>QueryResult</code>，以便為非同步驅動程式提供更好的游標支援。</p></li><li><p><a href="https://sqldelight.github.io/sqldelight/latest/2.x/runtime/app.cash.sqldelight.db/-sql-schema" target="_blank" rel="noreferrer"><code>SqlSchema</code></a> 介面現在具有一個泛型 <code>QueryResult</code> 類型參數。這用於區分那些為非同步驅動程式生成的 schema 執行時，這些執行時可能與同步驅動程式不直接相容。 這僅與同時使用同步和非同步驅動程式的專案相關，例如具有 JS 目標的多平台專案。有關更多詳細資訊，請參閱“<a href="/zh-Hant/sqldelight/js_sqlite/multiplatform.md">使用 Web Worker 驅動程式進行多平台設定</a>”。</p></li><li><p><code>SqlSchema.Version</code> 的類型從 Int 變更為 Long，以允許伺服器環境利用時間戳作為版本。現有設定可以安全地在 Int 和 Long 之間進行轉換，而要求版本在 Int 範圍內的驅動程式，若版本超出範圍，則會在資料庫建立前崩潰。</p></li></ul>`,11)]))}const E=i(t,[["render",n]]);export{c as __pageData,E as default};
