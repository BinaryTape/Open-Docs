import{_ as d,C as n,c as k,o as g,j as a,G as e,ag as c,a as i,w as p}from"./chunks/framework.Bksy39di.js";const f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"zh-Hant/ktor/google-app-engine.md","filePath":"zh-Hant/ktor/google-app-engine.md","lastUpdated":1755457140000}'),E={name:"zh-Hant/ktor/google-app-engine.md"};function u(y,s,m,F,b,C){const l=n("show-structure"),t=n("control"),o=n("tldr"),h=n("web-summary"),r=n("link-summary");return g(),k("div",null,[s[8]||(s[8]=a("h1",{id:"google-app-engine",tabindex:"-1"},[i("Google App Engine "),a("a",{class:"header-anchor",href:"#google-app-engine","aria-label":'Permalink to "Google App Engine"'},"​")],-1)),e(l,{for:"chapter",depth:"2"}),e(o,null,{default:p(()=>[a("p",null,[e(t,null,{default:p(()=>s[0]||(s[0]=[i("初始專案")])),_:1}),s[1]||(s[1]=i(": ")),s[2]||(s[2]=a("a",{href:"https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main"},"engine-main",-1))]),a("p",null,[e(t,null,{default:p(()=>s[3]||(s[3]=[i("最終專案")])),_:1}),s[4]||(s[4]=i(": ")),s[5]||(s[5]=a("a",{href:"https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/google-appengine-standard"},"google-appengine-standard",-1))])]),_:1}),e(h,null,{default:p(()=>s[6]||(s[6]=[i(" 本教學課程將展示如何準備 Ktor 專案並將其部署到 Google App Engine 標準環境。 ")])),_:1}),e(r,null,{default:p(()=>s[7]||(s[7]=[i(" 學習如何將專案部署到 Google App Engine 標準環境。 ")])),_:1}),s[9]||(s[9]=c(`<p>在本教學課程中，我們將展示如何準備 Ktor 專案並將其部署到 Google App Engine 標準環境。本教學課程使用 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main" target="_blank" rel="noreferrer">engine-main</a> 範例專案作為起始專案。</p><h2 id="prerequisites" tabindex="-1">必要條件 <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;必要條件 {id=&quot;prerequisites&quot;}&quot;">​</a></h2><p>在開始本教學課程之前，您需要執行以下步驟：</p><ul><li>註冊 <a href="https://console.cloud.google.com/" target="_blank" rel="noreferrer">Google Cloud Platform</a>。</li><li>安裝並初始化 <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noreferrer">Google Cloud SDK</a>。</li><li>使用以下命令安裝適用於 Java 的 App Engine 擴充功能：<div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> components</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-engine-java</span></span></code></pre></div></li></ul><h2 id="clone" tabindex="-1">複製範例應用程式 <a class="header-anchor" href="#clone" aria-label="Permalink to &quot;複製範例應用程式 {id=&quot;clone&quot;}&quot;">​</a></h2><p>要開啟範例應用程式，請按照以下步驟操作：</p><ol><li>複製 Ktor 文件儲存庫並開啟 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets" target="_blank" rel="noreferrer">codeSnippets</a> 專案。</li><li>開啟 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main" target="_blank" rel="noreferrer">engine-main</a> 模組。 <blockquote><p>請注意，Ktor 提供兩種方式來 <a href="./server-create-and-configure">建立和設定伺服器</a>：透過程式碼或使用設定檔。在本教學課程中，部署過程對於這兩種方式都是相同的。</p></blockquote></li></ol><h2 id="prepare-app" tabindex="-1">準備應用程式 <a class="header-anchor" href="#prepare-app" aria-label="Permalink to &quot;準備應用程式 {id=&quot;prepare-app&quot;}&quot;">​</a></h2><h3 id="configure-shadow-plugin" tabindex="-1">步驟 1：套用 Shadow 外掛程式 <a class="header-anchor" href="#configure-shadow-plugin" aria-label="Permalink to &quot;步驟 1：套用 Shadow 外掛程式 {id=&quot;configure-shadow-plugin&quot;}&quot;">​</a></h3><p>本教學課程展示了如何使用 <a href="./server-fatjar">fat JAR</a> 將應用程式部署到 Google App Engine。要產生 fat JAR，您需要套用 Shadow 外掛程式。開啟 <code>build.gradle.kts</code> 檔案並將此外掛程式新增到 <code>plugins</code> 區塊中：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.gradleup.shadow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) version </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8.3.9&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="configure-app-engine-plugin" tabindex="-1">步驟 2：設定 App Engine 外掛程式 <a class="header-anchor" href="#configure-app-engine-plugin" aria-label="Permalink to &quot;步驟 2：設定 App Engine 外掛程式 {id=&quot;configure-app-engine-plugin&quot;}&quot;">​</a></h3><p><a href="https://github.com/GoogleCloudPlatform/app-gradle-plugin" target="_blank" rel="noreferrer">Google App Engine Gradle plugin</a> 提供用於建置和部署 Google App Engine 應用程式的任務。要使用此外掛程式，請按照以下步驟操作：</p><ol><li><p>開啟 <code>settings.gradle.kts</code> 檔案並插入以下程式碼以從 Central Maven 儲存庫引用外掛程式：</p><div class="language-groovy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pluginManagement {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    repositories {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        gradlePluginPortal()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mavenCentral()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        maven(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://maven.pkg.jetbrains.space/public/p/ktor/eap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    resolutionStrategy {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        eachPlugin {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (requested</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">startsWith(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools.appengine&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                useModule(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools:appengine-gradle-plugin:\${requested.version}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>開啟 <code>build.gradle.kts</code> 並在 <code>plugins</code> 區塊中套用此外掛程式：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools.appengine&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) version </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.8.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>在 <code>build.gradle.kts</code> 檔案中加入帶有以下設定的 <code>appengine</code> 區塊：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> com.google.cloud.tools.gradle.appengine.appyaml.AppEngineAppYamlExtension</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppEngineAppYamlExtension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setArtifact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build/libs/\${project.name}-all.jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCLOUD_CONFIG&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        projectId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCLOUD_CONFIG&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ol><h3 id="configure-app-engine-settings" tabindex="-1">步驟 3：設定 App Engine 配置 <a class="header-anchor" href="#configure-app-engine-settings" aria-label="Permalink to &quot;步驟 3：設定 App Engine 配置 {id=&quot;configure-app-engine-settings&quot;}&quot;">​</a></h3><p>您可以在 <a href="https://cloud.google.com/appengine/docs/standard/python/config/appref" target="_blank" rel="noreferrer">app.yaml</a> 檔案中配置應用程式的 App Engine 設定：</p><ol><li><p>在 <code>src/main</code> 內部建立 <code>appengine</code> 目錄。</p></li><li><p>在此目錄中，建立 <code>app.yaml</code> 檔案並加入以下內容（將 <code>google-appengine-standard</code> 替換為您的專案名稱）：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">runtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">java21</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">entrypoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;java -jar google-appengine-standard-all.jar&#39;</span></span></code></pre></div><p><code>entrypoint</code> 選項包含一個用於執行為應用程式生成的 fat JAR 的命令。</p><p>有關支援的設定選項的更多文件，請參閱 <a href="https://cloud.google.com/appengine/docs/standard/reference/app-yaml?tab=java" target="_blank" rel="noreferrer">Google AppEngine documentation</a>。</p></li></ol><h2 id="deploy-app" tabindex="-1">部署應用程式 <a class="header-anchor" href="#deploy-app" aria-label="Permalink to &quot;部署應用程式 {id=&quot;deploy-app&quot;}&quot;">​</a></h2><p>要部署應用程式，請開啟終端機並按照以下步驟操作：</p><ol><li><p>首先，建立一個 Google Cloud 專案，它是一個包含應用程式資源的頂層容器。例如，以下命令會建立一個名為 <code>ktor-sample-app-engine</code> 的專案：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> projects</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ktor-sample-app-engine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-as-default</span></span></code></pre></div></li><li><p>為 Cloud 專案建立一個 App Engine 應用程式：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span></span></code></pre></div></li><li><p>要部署應用程式，請執行 <code>appengineDeploy</code> Gradle 任務...</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> appengineDeploy</span></span></code></pre></div><p>... 並等待 Google Cloud 建置並發佈應用程式：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>...done.</span></span>
<span class="line"><span>Deployed service [default] to [https://ktor-sample-app-engine.ew.r.appspot.com]</span></span></code></pre></div><div class="note custom-block"><p class="custom-block-title">NOTE</p><p>如果您在建置期間收到 <code>Cloud Build has not been used in project</code> 錯誤，請依照錯誤報告中的指示啟用它。</p></div></li></ol><p>您可以在此處找到完整的範例：<a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/google-appengine-standard" target="_blank" rel="noreferrer">google-appengine-standard</a>。</p>`,21))])}const q=d(E,[["render",u]]);export{f as __pageData,q as default};
