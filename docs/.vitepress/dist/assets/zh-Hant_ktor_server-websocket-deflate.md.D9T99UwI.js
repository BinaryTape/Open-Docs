import{_ as a,c as i,o as e,ag as n}from"./chunks/framework.Bksy39di.js";const c=JSON.parse('{"title":"WebSocket Deflate 擴充功能","description":"","frontmatter":{},"headers":[],"relativePath":"zh-Hant/ktor/server-websocket-deflate.md","filePath":"zh-Hant/ktor/server-websocket-deflate.md","lastUpdated":1755457140000}'),t={name:"zh-Hant/ktor/server-websocket-deflate.md"};function l(p,s,h,k,r,o){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="websocket-deflate-擴充功能" tabindex="-1">WebSocket Deflate 擴充功能 <a class="header-anchor" href="#websocket-deflate-擴充功能" aria-label="Permalink to &quot;WebSocket Deflate 擴充功能&quot;">​</a></h1><p>Ktor 實作了適用於客戶端和伺服器的 <code>Deflate</code> WebSocket 擴充功能 <a href="https://tools.ietf.org/html/rfc7692" target="_blank" rel="noreferrer">RFC-7692</a>。此擴充功能可以在傳送前透明地壓縮訊框，並在接收後解壓縮。如果您正在傳送大量文字資料，啟用此擴充功能會很有用。</p><h2 id="安裝" tabindex="-1">安裝 <a class="header-anchor" href="#安裝" aria-label="Permalink to &quot;安裝&quot;">​</a></h2><p>若要使用此擴充功能，應首先安裝它。為此，我們可以在 <code>extensions</code> 區塊中使用 <code>install</code> 方法：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 適用於客戶端和伺服器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WebSockets) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WebSocketDeflateExtension) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * 用於 [java.util.zip.Deflater] 的壓縮等級。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            compressionLevel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Deflater.DEFAULT_COMPRESSION</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             * 防止壓縮小型傳出訊框。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            compressIfBiggerThan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="進階配置參數" tabindex="-1">進階配置參數 <a class="header-anchor" href="#進階配置參數" aria-label="Permalink to &quot;進階配置參數&quot;">​</a></h3><h4 id="上下文接管" tabindex="-1">上下文接管 <a class="header-anchor" href="#上下文接管" aria-label="Permalink to &quot;上下文接管&quot;">​</a></h4><p>指定客戶端 (和伺服器) 是否應使用壓縮視窗。啟用這些參數可減少每個單一工作階段所分配的空間量。請注意，由於 <code>java.util.zip.Deflater</code> API 的限制，視窗大小無法配置。此值固定為 <code>15</code>。</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clientNoContextTakeOver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serverNoContextTakeOver </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span></code></pre></div><p>這些參數描述於 <a href="https://tools.ietf.org/html/rfc7692#section-7.1.1" target="_blank" rel="noreferrer">RFC-7692 第 7.1.1 節</a></p><h4 id="指定壓縮條件" tabindex="-1">指定壓縮條件 <a class="header-anchor" href="#指定壓縮條件" aria-label="Permalink to &quot;指定壓縮條件&quot;">​</a></h4><p>若要明確指定壓縮條件，您可以使用 <code>compressIf</code> 方法。例如，僅壓縮文字：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compressIf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Frame.Text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在壓縮發生之前，所有對 <code>compressIf</code> 的呼叫都將被評估。</p><h4 id="微調協定列表" tabindex="-1">微調協定列表 <a class="header-anchor" href="#微調協定列表" aria-label="Permalink to &quot;微調協定列表&quot;">​</a></h4><p>要傳送的協定列表可以透過 <code>configureProtocols</code> 方法視需要編輯：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configureProtocols</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { protocols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    protocols.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    protocols.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,17)]))}const E=a(t,[["render",l]]);export{c as __pageData,E as default};
