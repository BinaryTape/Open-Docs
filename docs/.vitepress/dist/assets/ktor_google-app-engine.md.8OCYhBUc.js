import{_ as d,C as n,c as k,o as g,j as a,G as e,ag as c,a as i,w as p}from"./chunks/framework.Bksy39di.js";const f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"ktor/google-app-engine.md","filePath":"ktor/google-app-engine.md","lastUpdated":1755457140000}'),E={name:"ktor/google-app-engine.md"};function u(y,s,m,F,b,C){const l=n("show-structure"),t=n("control"),o=n("tldr"),h=n("web-summary"),r=n("link-summary");return g(),k("div",null,[s[8]||(s[8]=a("h1",{id:"google-app-engine",tabindex:"-1"},[i("Google App Engine "),a("a",{class:"header-anchor",href:"#google-app-engine","aria-label":'Permalink to "Google App Engine"'},"​")],-1)),e(l,{for:"chapter",depth:"2"}),e(o,null,{default:p(()=>[a("p",null,[e(t,null,{default:p(()=>s[0]||(s[0]=[i("初始项目")])),_:1}),s[1]||(s[1]=i(": ")),s[2]||(s[2]=a("a",{href:"https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main"},"engine-main",-1))]),a("p",null,[e(t,null,{default:p(()=>s[3]||(s[3]=[i("最终项目")])),_:1}),s[4]||(s[4]=i(": ")),s[5]||(s[5]=a("a",{href:"https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/google-appengine-standard"},"google-appengine-standard",-1))])]),_:1}),e(h,null,{default:p(()=>s[6]||(s[6]=[i(" 本教程展示了如何准备 Ktor 项目并将其部署到 Google App Engine 标准环境。 ")])),_:1}),e(r,null,{default:p(()=>s[7]||(s[7]=[i(" 了解如何将你的项目部署到 Google App Engine 标准环境。 ")])),_:1}),s[9]||(s[9]=c(`<p>在本教程中，我们将向你展示如何准备 Ktor 项目并将其部署到 Google App Engine 标准环境。本教程使用 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main" target="_blank" rel="noreferrer">engine-main</a> 示例项目作为起始项目。</p><h2 id="prerequisites" tabindex="-1">先决条件 <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;先决条件 {id=&quot;prerequisites&quot;}&quot;">​</a></h2><p>在开始本教程之前，你需要执行以下步骤：</p><ul><li>注册 <a href="https://console.cloud.google.com/" target="_blank" rel="noreferrer">Google Cloud Platform</a>。</li><li>安装并初始化 <a href="https://cloud.google.com/sdk/docs/install" target="_blank" rel="noreferrer">Google Cloud SDK</a>。</li><li>使用以下命令安装适用于 Java 的 App Engine 扩展项：<div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> components</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-engine-java</span></span></code></pre></div></li></ul><h2 id="clone" tabindex="-1">克隆示例应用程序 <a class="header-anchor" href="#clone" aria-label="Permalink to &quot;克隆示例应用程序 {id=&quot;clone&quot;}&quot;">​</a></h2><p>要打开示例应用程序，请按照以下步骤操作：</p><ol><li>克隆 Ktor 文档版本库并打开 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets" target="_blank" rel="noreferrer">codeSnippets</a> 项目。</li><li>打开 <a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/engine-main" target="_blank" rel="noreferrer">engine-main</a> 模块。 <blockquote><p>请注意，Ktor 提供了两种 <a href="./server-create-and-configure">创建和配置服务器</a> 的方法：在代码中或使用配置文件。在本教程中，部署过程对于这两种方法都是相同的。</p></blockquote></li></ol><h2 id="prepare-app" tabindex="-1">准备应用程序 <a class="header-anchor" href="#prepare-app" aria-label="Permalink to &quot;准备应用程序 {id=&quot;prepare-app&quot;}&quot;">​</a></h2><h3 id="configure-shadow-plugin" tabindex="-1">步骤 1: 应用 Shadow 插件 <a class="header-anchor" href="#configure-shadow-plugin" aria-label="Permalink to &quot;步骤 1: 应用 Shadow 插件 {id=&quot;configure-shadow-plugin&quot;}&quot;">​</a></h3><p>本教程展示了如何使用 <a href="./server-fatjar">fat JAR</a> 将应用程序部署到 Google App Engine。要生成 fat JAR，你需要应用 Shadow 插件。打开 <code>build.gradle.kts</code> 文件并将插件添加到 <code>plugins</code> 代码块：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.gradleup.shadow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) version </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8.3.9&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="configure-app-engine-plugin" tabindex="-1">步骤 2: 配置 App Engine 插件 <a class="header-anchor" href="#configure-app-engine-plugin" aria-label="Permalink to &quot;步骤 2: 配置 App Engine 插件 {id=&quot;configure-app-engine-plugin&quot;}&quot;">​</a></h3><p><a href="https://github.com/GoogleCloudPlatform/app-gradle-plugin" target="_blank" rel="noreferrer">Google App Engine Gradle 插件</a> 提供构建和部署 Google App Engine 应用程序的任务。要使用此插件，请按照以下步骤操作：</p><ol><li><p>打开 <code>settings.gradle.kts</code> 文件并插入以下代码以从中央 Maven 版本库引用插件：</p><div class="language-groovy vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pluginManagement {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    repositories {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        gradlePluginPortal()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mavenCentral()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        maven(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://maven.pkg.jetbrains.space/public/p/ktor/eap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    resolutionStrategy {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        eachPlugin {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (requested</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">startsWith(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools.appengine&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                useModule(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools:appengine-gradle-plugin:\${requested.version}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>打开 <code>build.gradle.kts</code> 并在 <code>plugins</code> 代码块中应用插件：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.cloud.tools.appengine&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) version </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.8.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>在 <code>build.gradle.kts</code> 文件中添加 <code>appengine</code> 代码块并包含以下设置：</p><div class="language-kotlin vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> com.google.cloud.tools.gradle.appengine.appyaml.AppEngineAppYamlExtension</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AppEngineAppYamlExtension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setArtifact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;build/libs/\${project.name}-all.jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        version </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCLOUD_CONFIG&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        projectId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GCLOUD_CONFIG&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ol><h3 id="configure-app-engine-settings" tabindex="-1">步骤 3: 配置 App Engine 设置 <a class="header-anchor" href="#configure-app-engine-settings" aria-label="Permalink to &quot;步骤 3: 配置 App Engine 设置 {id=&quot;configure-app-engine-settings&quot;}&quot;">​</a></h3><p>你可以在 <a href="https://cloud.google.com/appengine/docs/standard/python/config/appref" target="_blank" rel="noreferrer">app.yaml</a> 文件中配置应用程序的 App Engine 设置：</p><ol><li><p>在 <code>src/main</code> 内部创建 <code>appengine</code> 目录。</p></li><li><p>在此目录内部，创建 <code>app.yaml</code> 文件并添加以下内容（将 <code>google-appengine-standard</code> 替换为你的项目名称）：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">runtime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">java21</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">entrypoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;java -jar google-appengine-standard-all.jar&#39;</span></span></code></pre></div><p><code>entrypoint</code> 选项包含一个命令，用于运行为应用程序生成的 fat JAR。</p><p>关于支持的配置选项的更多文档可以在 <a href="https://cloud.google.com/appengine/docs/standard/reference/app-yaml?tab=java" target="_blank" rel="noreferrer">Google AppEngine 文档</a> 中找到。</p></li></ol><h2 id="deploy-app" tabindex="-1">部署应用程序 <a class="header-anchor" href="#deploy-app" aria-label="Permalink to &quot;部署应用程序 {id=&quot;deploy-app&quot;}&quot;">​</a></h2><p>要部署应用程序，请打开终端并按照以下步骤操作：</p><ol><li><p>首先，创建一个 Google Cloud 项目，它是一个用于存放应用程序资源的顶层容器。例如，以下命令创建一个名为 <code>ktor-sample-app-engine</code> 的项目：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> projects</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ktor-sample-app-engine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set-as-default</span></span></code></pre></div></li><li><p>为 Cloud 项目创建一个 App Engine 应用程序：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gcloud</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span></span></code></pre></div></li><li><p>要部署应用程序，请执行 <code>appengineDeploy</code> Gradle 任务……</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./gradlew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> appengineDeploy</span></span></code></pre></div><p>……然后等待 Google Cloud 构建并发布应用程序：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>...done.</span></span>
<span class="line"><span>Deployed service [default] to [https://ktor-sample-app-engine.ew.r.appspot.com]</span></span></code></pre></div><div class="note custom-block"><p class="custom-block-title">NOTE</p><p>如果你在构建期间收到 <code>Cloud Build has not been used in project</code> 错误，请根据错误报告中的说明启用它。</p></div></li></ol><p>你可以在此处找到完整的示例：<a href="https://github.com/ktorio/ktor-documentation/tree/3.2.3/codeSnippets/snippets/google-appengine-standard" target="_blank" rel="noreferrer">google-appengine-standard</a>。</p>`,21))])}const q=d(E,[["render",u]]);export{f as __pageData,q as default};
