import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.Bksy39di.js";const E=JSON.parse('{"title":"커스텀 워커 구현하기","description":"","frontmatter":{},"headers":[],"relativePath":"ko/sqldelight/js_sqlite/custom_worker.md","filePath":"ko/sqldelight/js_sqlite/custom_worker.md","lastUpdated":1748435462000}'),e={name:"ko/sqldelight/js_sqlite/custom_worker.md"};function l(h,s,p,k,o,d){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="커스텀-워커-구현하기" tabindex="-1">커스텀 워커 구현하기 <a class="header-anchor" href="#커스텀-워커-구현하기" aria-label="Permalink to &quot;커스텀 워커 구현하기&quot;">​</a></h1><p>SQLDelight 웹 워커는 웹 워커 드라이버로부터 수신 메시지를 받고, 해당 메시지를 사용하여 일부 SQL 작업을 실행한 다음, 쿼리 결과에 따라 응답할 수 있는 스크립트입니다.</p><p>웹 워커는 비교적 짧고 간단한 스크립트이므로, 일반 JavaScript로 구현하는 것이 가장 쉽습니다.</p><h2 id="수신-메시지" tabindex="-1">수신 메시지 <a class="header-anchor" href="#수신-메시지" aria-label="Permalink to &quot;수신 메시지&quot;">​</a></h2><p>웹 워커 드라이버 메시지 형식은 SQLDelight가 특정 SQL 방언이나 구현에 얽매이지 않는 일반적인 방식으로 워커 구현과 통신할 수 있도록 합니다. 모든 메시지에는 네 가지 액션 중 하나를 지정하는 <code>action</code> 속성이 포함되어 있습니다.</p><h3 id="exec" tabindex="-1"><code>exec</code> <a class="header-anchor" href="#exec" aria-label="Permalink to &quot;\`exec\`&quot;">​</a></h3><p>이 액션은 워커가 메시지에 첨부된 SQL 문을 실행하고 SQL 쿼리 결과로 응답해야 함을 나타냅니다. 메시지에는 실행할 SQL 문을 포함하는 <code>sql</code> 속성과 해당 문에 바인딩될 파라미터를 포함하는 <code>params</code> 배열이 포함됩니다.</p><p>메시지 예시:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;exec&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;sql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT column_a, column_b FROM some_table WHERE column_a = ?;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="begin-transaction" tabindex="-1"><code>begin_transaction</code> <a class="header-anchor" href="#begin-transaction" aria-label="Permalink to &quot;\`begin_transaction\`&quot;">​</a></h3><p>워커에게 트랜잭션을 시작해야 한다고 알립니다.</p><p>메시지 예시:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;begin_transaction&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="end-transaction" tabindex="-1"><code>end_transaction</code> <a class="header-anchor" href="#end-transaction" aria-label="Permalink to &quot;\`end_transaction\`&quot;">​</a></h3><p>워커에게 현재 트랜잭션을 종료해야 한다고 알립니다.</p><p>메시지 예시:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;end_transaction&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="rollback-transaction" tabindex="-1"><code>rollback_transaction</code> <a class="header-anchor" href="#rollback-transaction" aria-label="Permalink to &quot;\`rollback_transaction\`&quot;">​</a></h3><p>워커에게 현재 트랜잭션을 롤백해야 한다고 알립니다.</p><p>메시지 예시:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rollback_transaction&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="메시지-응답" tabindex="-1">메시지 응답 <a class="header-anchor" href="#메시지-응답" aria-label="Permalink to &quot;메시지 응답&quot;">​</a></h2><p>모든 수신 메시지에는 해당 메시지에 대한 고유한 정수인 <code>id</code> 속성이 포함되어 있습니다. 메시지에 응답할 때, 워커 구현은 응답 메시지에 이 <code>id</code> 값을 포함해야 합니다. 이는 웹 워커 드라이버가 응답을 올바르게 처리하는 데 사용됩니다.</p><h3 id="results-속성" tabindex="-1"><code>results</code> 속성 <a class="header-anchor" href="#results-속성" aria-label="Permalink to &quot;\`results\` 속성&quot;">​</a></h3><p>응답 메시지에는 또한 <code>results</code> 속성이 포함되어야 합니다. 이는 일부 SQL 실행 결과, 특히 쿼리의 결과 집합을 전달하는 데 사용됩니다. <code>results</code> 속성은 결과의 _행(row)_을 나타내는 배열이어야 하며, 각 항목은 결과 집합의 _열(column)_을 나타내는 배열입니다.</p><p>예를 들어, 위 <code>exec</code> 메시지에 대한 응답은 다음과 같을 수 있습니다:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;results&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;this is the content of column_b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;this is a different row&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>결과 집합을 반환하지 않는 SQL 문의 경우, <code>results</code> 값은 해당 문 실행으로 영향을 받은 행의 수를 나타내는 숫자를 포함하는 단일 행/열이어야 합니다.</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;results&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [ [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="예시" tabindex="-1">예시 <a class="header-anchor" href="#예시" aria-label="Permalink to &quot;예시&quot;">​</a></h2><ul><li><a href="https://github.com/cashapp/sqldelight/blob/master/drivers/web-worker-driver/sqljs/sqljs.worker.js" target="_blank" rel="noreferrer">SQLDelight의 SQL.js 워커</a></li></ul>`,31)]))}const c=i(e,[["render",l]]);export{E as __pageData,c as default};
