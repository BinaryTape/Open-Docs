[//]: # (title: Kotlin Multiplatform 入門)

マルチプラットフォームプログラミングのサポートは、Kotlinの主要な利点の一つです。これは、[異なるプラットフォーム](multiplatform-dsl-reference.md#targets)向けに同じコードを記述・保守する時間を削減しつつ、ネイティブプログラミングの柔軟性と利点を維持します。

![Kotlin Multiplatform](kotlin-multiplatform.svg){width=700}

## 主要な概念を学ぶ

Kotlin Multiplatform を使用すると、モバイル、ウェブ、デスクトップといった様々なプラットフォーム間でコードを共有できます。コードがコンパイルされるプラットフォームは、_ターゲット_ のリストによって定義されます。

各ターゲットには対応する_ソースセット_があり、これは独自の依存関係とコンパイラオプションを持つソースファイルのセットを表します。例えば JVM 用の `jvmMain` のようなプラットフォーム固有のソースセットは、プラットフォーム固有のライブラリや API を利用できます。

ターゲットのサブセット間でコードを共有するために、中間ソースセットが使用されます。例えば、`appleMain` ソースセットは、すべての Apple プラットフォーム間で共有されるコードを表します。すべてのプラットフォーム間で共有され、宣言されたすべてのターゲットにコンパイルされるコードは、独自のソースセット `commonMain` を持ちます。これはプラットフォーム固有の API を使用することはできませんが、マルチプラットフォームライブラリを利用できます。

特定のターゲット向けにコンパイルする場合、Kotlin は共通ソースセット、関連する中間ソースセット、およびターゲット固有のソースセットを結合します。

このトピックの詳細については、以下を参照してください:

*   [Kotlin Multiplatform プロジェクト構造の基本](multiplatform-discover-project.md)
*   [マルチプラットフォームプロジェクト構造の高度な概念](multiplatform-advanced-project-structure.md)

## コード共有メカニズムを使用する

類似のターゲットのサブセット間でコードを共有する方が便利な場合があります。Kotlin Multiplatform は、_デフォルト階層テンプレート_ を使用して、その作成を簡素化する方法を提供します。これには、プロジェクトで指定したターゲットに基づいて作成される、事前定義された中間ソースセットのリストが含まれます。

共有コードからプラットフォーム固有の API にアクセスするには、もう一つの Kotlin メカニズムである _expected および actual 宣言_ を使用できます。これにより、共通コードでプラットフォーム固有の API を `expect` することを宣言し、各ターゲットプラットフォーム向けに個別の `actual` 実装を提供できます。このメカニズムは、関数、クラス、インターフェースを含む様々な Kotlin の概念で使用できます。例えば、共通コードで関数を定義し、対応するソースセットでプラットフォーム固有のライブラリを使用してその実装を提供できます。

このトピックの詳細については、以下を参照してください:

*   [プラットフォームでコードを共有する](multiplatform-share-on-platforms.md)
*   [Expected および actual 宣言](multiplatform-expect-actual.md)
*   [階層型プロジェクト構造](multiplatform-hierarchy.md)

## 依存関係を追加する

Kotlin Multiplatform プロジェクトは、外部ライブラリや他のマルチプラットフォームプロジェクトに依存できます。共通コードの場合、共通ソースセットにマルチプラットフォームライブラリへの依存関係を追加できます。Kotlin は、適切なプラットフォーム固有の部品を他のソースセットに自動的に解決し、追加します。プラットフォーム固有の API のみが要求される場合は、対応するソースセットに依存関係を追加してください。

Kotlin Multiplatform プロジェクトに Android 固有の依存関係を追加することは、純粋な Android プロジェクトに追加するのと似ています。iOS 固有の依存関係を扱う場合、追加の設定なしで Apple SDK フレームワークをシームレスに統合できます。外部ライブラリやフレームワークに対しては、Kotlin は Objective-C および Swift との相互運用性を提供します。

このトピックの詳細については、以下を参照してください:

*   [マルチプラットフォームライブラリに依存関係を追加する](multiplatform-add-dependencies.md)
*   [Android ライブラリに依存関係を追加する](multiplatform-android-dependencies.md)
*   [iOS ライブラリに依存関係を追加する](multiplatform-ios-dependencies.md)

## iOS との統合を設定する

マルチプラットフォームプロジェクトが iOS をターゲットとする場合、Kotlin Multiplatform 共有モジュールと iOS アプリとの統合を設定できます。

そのためには、iOS フレームワークを生成し、それをローカルまたはリモートの依存関係として iOS プロジェクトに追加します:

*   **ローカル統合**: 特別なスクリプトを使用してマルチプラットフォームプロジェクトと Xcode プロジェクトを直接接続するか、ローカル Pod 依存関係を含むセットアップでは CocoaPods 依存関係マネージャーを使用します。
*   **リモート統合**: XCFramework を使用して SPM 依存関係を設定するか、CocoaPods を介して共有モジュールを配布します。

このトピックの詳細については、[iOS 統合方法](multiplatform-ios-integration-overview.md)を参照してください。

## コンパイルを設定する

各ターゲットは、異なる目的のために複数のコンパイルを持つことができ、通常はプロダクションまたはテスト用ですが、カスタムコンパイルを定義することもできます。

Kotlin Multiplatform を使用すると、プロジェクト内のすべてのコンパイルを設定したり、ターゲット内で特定のコンパイルを設定したり、個別のコンパイルを作成することさえできます。コンパイルを設定する際、コンパイラオプションを変更したり、依存関係を管理したり、ネイティブ言語との相互運用性を設定したりできます。

このトピックの詳細については、[コンパイルを設定する](multiplatform-configure-compilations.md)を参照してください。

## 最終的なバイナリをビルドする

デフォルトでは、ターゲットは `.klib` アーティファクトにコンパイルされ、これは Kotlin/Native 自体によって依存関係として消費できますが、実行したり、ネイティブライブラリとして使用したりすることはできません。しかし、Kotlin Multiplatform は最終的なネイティブバイナリをビルドするための追加メカニズムを提供します。

実行可能バイナリ、共有ライブラリ、静的ライブラリ、または Objective-C フレームワークを作成でき、それぞれ異なるビルドタイプ向けに設定可能です。Kotlin はまた、iOS 統合のためのユニバーサル (fat) フレームワークおよび XCFramework をビルドする方法も提供します。

このトピックの詳細については、[ネイティブバイナリをビルドする](multiplatform-build-native-binaries.md)を参照してください。

## マルチプラットフォームライブラリを作成する

共通コードと、JVM、ウェブ、ネイティブプラットフォーム向けのプラットフォーム固有の実装を持つマルチプラットフォームライブラリを作成できます。

Kotlin Multiplatform ライブラリを公開するには、Gradle ビルドスクリプトでの特定の設定が必要です。公開には Maven リポジトリと `maven-publish` プラグインを使用できます。一度公開されたマルチプラットフォームライブラリは、他のクロスプラットフォームプロジェクトで依存関係として使用できます。

このトピックの詳細については、[マルチプラットフォームライブラリを公開する](multiplatform-publish-lib-setup.md)を参照してください。

## 参考

*   [Kotlin Multiplatform Gradle プラグインの DSL リファレンス](multiplatform-dsl-reference.md)
*   [Kotlin Multiplatform 互換性ガイド](multiplatform-compatibility-guide.md)